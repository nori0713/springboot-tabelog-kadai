document.addEventListener('DOMContentLoaded', function() {
    let maxDate = new Date();
    maxDate.setMonth(maxDate.getMonth() + 3); // 最大3ヶ月先まで選択可能

    let minDate = new Date();
    minDate.setDate(minDate.getDate() + 1); // 今日の翌日から選択可能

    // 予約日用のflatpickr設定
    const reservationDateInput = document.querySelector('#reservationDate');
    if (reservationDateInput) {
        flatpickr(reservationDateInput, {
            locale: 'ja',
            minDate: minDate,
            maxDate: maxDate,
            dateFormat: "Y-m-d",
            defaultDate: minDate
        });
    }

    // 開店時間のflatpickr設定
    const openingTimeInput = document.querySelector('#openingTime');
    if (openingTimeInput) {
        flatpickr(openingTimeInput, {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true,
            defaultHour: 9, // デフォルトを9時に設定
            minuteIncrement: 60 // 60分刻み
        });
    }

    // 閉店時間のflatpickr設定
    const closingTimeInput = document.querySelector('#closingTime');
    if (closingTimeInput) {
        flatpickr(closingTimeInput, {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true,
            defaultHour: 22, // デフォルトを22時に設定
            minuteIncrement: 60
        });
    }

    // 予約時間の更新関数
    const reservationTimeInput = document.querySelector('#reservationTime');
    if (reservationTimeInput) {
        updateReservationTime(); // ページ読み込み時に初期化
    }

    // 開店・閉店時間が変更された際に予約時間を更新
    document.querySelector('#openingTime')?.addEventListener('change', function() {
        updateReservationTime();
    });

    document.querySelector('#closingTime')?.addEventListener('change', function() {
        updateReservationTime();
    });

    // 予約時間の選択肢を更新する関数
    function updateReservationTime() {
        const openingTime = document.querySelector('#openingTime')?.value || '09:00';
        const closingTime = document.querySelector('#closingTime')?.value || '22:00';

        // プルダウン内のオプションを更新
        let timeOptions = [];
        let currentTime = openingTime;

        // 予約時間を1時間刻みで生成し、プルダウン用の選択肢を作成
        while (currentTime < closingTime) {
            timeOptions.push(currentTime);
            currentTime = incrementTime(currentTime, 1); // 1時間加算
        }

        // プルダウンに選択肢を設定
        reservationTimeInput.innerHTML = ''; // 一旦クリア
        timeOptions.forEach(function(time) {
            let option = document.createElement('option');
            option.value = time;
            option.textContent = time;
            reservationTimeInput.appendChild(option);
        });
    }

    // 時間をインクリメントするヘルパー関数 (HH:mm形式で1時間加算)
    function incrementTime(time, hours) {
        let [hour, minute] = time.split(':').map(Number);
        hour = (hour + hours) % 24;
        return hour.toString().padStart(2, '0') + ':' + minute.toString().padStart(2, '0');
    }
});